---
import PageLayout from '../../layouts/PageLayout.astro';
import { getCollection, getEntry, render } from 'astro:content';
import AuthorBio from '../../components/AuthorBio.astro';
import RelatedPosts from '../../components/RelatedPosts.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  console.log('Blog entries:', blogEntries);
  return blogEntries.map(entry => ({
    params: { slug: entry.data.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Author data formatted for AuthorBio component
const author = {
  name: entry.data.author,
  image: entry.data.authorImage,
  bio: entry.data.authorBio,
  social: entry.data.authorSocial || {}
};
---

<PageLayout title={entry.data.title} description={entry.data.metaDescription || entry.data.description}>
  <article class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Blog Header -->
    <header class="mb-12">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white animate-reveal mb-4">
        <span class="bg-clip-text text-transparent bg-gradient-to-r from-white to-yellow-300">
          {entry.data.title}
        </span>
      </h1>
      <div class="flex items-center text-neutral-400 text-sm">
        <i class="fas fa-calendar-alt mr-2"></i>
        <time datetime={entry.data.date}>{entry.data.date}</time>
      </div>
    </header>

    <!-- Featured Image -->
    {entry.data.image && (
      <figure class="mb-12 rounded-xl overflow-hidden">
        <img
          src={entry.data.image}
          alt={entry.data.imageAlt}
          class="w-full h-auto max-h-[32rem] object-cover"
          loading="lazy"
          width={1200}
          height={630}
        />
        {entry.data.imageCaption && (
          <figcaption class="text-center text-neutral-400 text-sm mt-2">
            {entry.data.imageCaption}
          </figcaption>
        )}
      </figure>
    )}

    <!-- Blog Content -->
    <section class="post-content max-w-3xl px-4 mx-auto">
      <Content />
    </section>

    <!-- Author Bio -->
    <footer class="mt-16 pt-8 border-t border-neutral-700 mb-12">
      <AuthorBio author={author} />
    </footer>

  </article>
</PageLayout>